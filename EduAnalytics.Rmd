---
title: "EduAnalytics"
author: "MinaEkramnia"
date: "11/19/2019"
output: html_document
---

```{r setup, include=FALSE}
if(!require(ggplot2)){install.packages("ggplot2")} 
#if(!require(sf)){install.packages("sf")} 
install.packages("httr") #for reading APIs
require("httr")
install.packages("jsonlite") #for reading APIs
require("jsonlite")
#install.packages("rsdmx")
library(tidyverse)
library(dplyr)
#library(raster)
library(tidyr)
#library(spData)
#library(spDataLarge)
#library(tmap)    # for static and interactive maps
#library(leaflet) # for interactive maps
#library(mapview) # for interactive maps
library(ggplot2) # tidyverse data visualization package
#library(shiny)   # for web applications
#require("plyr")
#require(rgdal)
#library(sf)
```

## Retrieving the Data
Using World Bank API, I derived the API for the Life Expectancy at birth (in years) for all countries in the WDI starting 1960. I was using JSON format at first, however since Rsdmx function in R doesn't work well with JSON, I decided to download the file from the API and then use it. 
```{r retrieve, include=FALSE}
#Retrieve Data from the API
temp <- tempfile()
download.file("https://api.worldbank.org/v2/en/country/all/indicator/SP.DYN.LE00.IN?downloadformat=csv&per_page=20000&source=2",temp)
# unzipping the downloaded file into an exported directory
unzip(temp, exdir = "/Users/minaekramnia/Downloads/WBDATA")
```

#Reading the Data
```{r read, include=FALSE}
df1 <-read.csv(file = "/Users/minaekramnia/Downloads/WBDATA/API_SP.DYN.LE00.IN_DS2_en_csv_v2_509980.csv", header=T, skip=4)

df2 <- read.csv(file = "/Users/minaekramnia/Downloads/WBDATA/Metadata_Country_API_SP.DYN.LE00.IN_DS2_en_csv_v2_509980.csv", header=TRUE, sep=",")
```

## Data Overview
First we want to explore the raw-data and see how can we improve it to transform it to a usable format. 

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

### Life Expectancy Data
```{r overview, echo = FALSE}
head(df1)
```
### Metadata Country
```{r overview, echo = FALSE}
head(df2)
```

```{r cleaning data, echo = FALSE}
df1clean <- df1[-(1:2),]# delete columns 1 through 2
```

## Plots
```{r map1, echo=FALSE}
#Joining two dataframe
#joined=inner_join(br_shp,lp,by="codmun7")
LEmap=inner_join(br_shp,lp,by="code")
```

#Map of the world

Here we can see the Life Expectancy across different countries. 

```{r mapping, echo=FALSE}
world<-st_read(".shp")

ggplot(LEmap) +
  geom_sf(aes(fill=average of LE joined$goS_learning_p)))color=NA) +
  scale_fill_gradient(low=, high=)
  theme(legend.position =
          "bottom") +
  ggtitle("Brazil Hot Spot Map",
  subtitle="Year 2013") +
  theme_minimal() + scale_colour_manual(values = col,  labels = c("Hot Spot - 90% Confidence", "Hot Spot - 95% Confidence", "Hot Spot - 99% Confidence", "Not Significant", "Cold Spot - 90% Confidence", "Cold Spot - 95% Confidence", "Cold Spot - 99% Confidence"))
  
  tmap is cool. use it!
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
